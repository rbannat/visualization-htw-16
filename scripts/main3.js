"use strict";!function(){var t={top:20,right:20,bottom:30,left:40},e=900-t.left-t.right,r=600-t.top-t.bottom,a=function(t){return t.Horsepower},n=d3.scale.linear().range([0,e]),i=d3.svg.axis().scale(n).orient("bottom"),l=function(t){return t.Acceleration},o=d3.scale.linear().range([r,0]),s=d3.svg.axis().scale(o).orient("left"),c=function(t){return t.Manufacturer},u=d3.scale.category20(),d=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),f=d3.svg.arc().outerRadius(function(t){var e=5,r=Math.sqrt(t.data.Weight/e/Math.PI);return r}).innerRadius(0),p=d3.layout.pie().sort(null).value(function(t){return t.Displacement/t.Cylinders}).padAngle(.03);d3.json("scripts/cars.json",function(m,g){var v=g,y=d3.select("#visualisation").append("svg").attr("width",e+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");n.domain([d3.min(v,a)-1,d3.max(v,a)+1]),o.domain([d3.min(v,l)-1,d3.max(v,l)+1]),y.append("g").attr("class","x-axis").attr("transform","translate(0,"+r+")").call(i).append("text").attr("class","label").attr("x",e).attr("y",-6).style("text-anchor","end").text("Horsepower"),y.append("g").attr("class","y-axis").call(s).append("text").attr("class","label").attr("y",6).attr("x",6).attr("dy",".71em").text("Acceleration");var x=function(t){y.selectAll(".pie").remove(),n.domain([d3.min(t,a)-1,d3.max(t,a)+1]),o.domain([d3.min(t,l)-1,d3.max(t,l)+1]),y.select(".x-axis").call(i),y.select(".y-axis").call(s);var e=y.selectAll(".pie").data(t);e.attr("transform",function(t){return"translate("+n(a(t))+","+o(l(t))+")"}),e.enter().append("g").filter(function(t){return"number"==typeof t.Horsepower}).attr("class","pie").attr("transform",function(t){return"translate("+n(a(t))+","+o(l(t))+")"}).on("mouseover",function(t){d.transition().duration(200).style("opacity",.9),d.html("Car: "+t.Car+"<br>Manufacturer: "+t.Manufacturer+"<br>MPG: "+t.MPG+"<br>Cylinders: "+t.Cylinders+"<br>Displacement: "+t.Displacement+"<br>Horsepower: "+t.Horsepower+"<br>Weight: "+t.Weight+"<br>Acceleration: "+t.Acceleration+"<br>Model Year: "+t["Model Year"]+"<br>Origin: "+t.Origin+"<br>").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){d.transition().duration(200).style("opacity",0)}),e.exit().remove();var r=e.selectAll(".arc").data(function(t){for(var e=[],r=0;r<parseInt(t.Cylinders);r++)e.push(t);return p(e)});r.attr("d",f).style("fill",function(t,e){return u(c(t.data))}),r.enter().append("path").attr("d",f).style("fill",function(t,e){return u(c(t.data))}),r.exit().remove()};x(v),$("#all").click(function(t){t.preventDefault(),x(v)}),$("#average").click(function(t){t.preventDefault(),x(h(v))});var h=function(t){var e=["Horsepower","MPG","Cylinders","Displacement","Weight","Acceleration"],r=t.reduce(function(t,r,a,n){if(r.Manufacturer in t.result){if(t.result[r.Manufacturer]&&b(r,e))for(var i=t.result[r.Manufacturer],l=0;l<e.length;l++)t.result[r.Manufacturer][e[l]]=(i[e[l]]*i.count+r[e[l]])/(i.count+1),t.result[r.Manufacturer].count++}else r.count=1,t.result[r.Manufacturer]=r;return t},{result:{}}).result,a=[];return Object.keys(r).forEach(function(t){a.push(r[t])}),a},b=function(t,e){for(var r=0;r<e.length;r++)if(isNaN(t[e[r]]))return!1;return!0}})}();