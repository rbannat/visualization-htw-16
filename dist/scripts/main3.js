"use strict";!function(){function t(){d.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function e(t){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0),l.start()}function n(t){d3.select(this).attr("cx",t.x=d3.event.x).attr("cy",t.y=d3.event.y)}function r(t){d3.select(this).classed("dragging",!1)}var a=960,i=500,t=d3.behavior.zoom().scaleExtent([0,10]).on("zoom",t),o=d3.behavior.drag().origin(function(t){return t}).on("dragstart",e).on("drag",n).on("dragend",r),c=d3.scale.sqrt().domain([0,20]).range([0,20]),l=d3.layout.force().charge(-240).linkDistance(40).size([a,i]),s=d3.select("#visualisation").append("svg").attr("width",a).attr("height",i).call(t),d=s.append("g");d3.xml("scripts/Old_New_Testament_Social_Network.xml","application/xml",function(t,e){if(t)throw t;var n=[].map.call(e.querySelectorAll("node"),function(t){return{id:parseInt(t.getAttribute("id")),text:t.querySelector("data").textContent}}),r=[].map.call(e.querySelectorAll("edge"),function(t){var e=parseInt(t.getAttribute("source")),r=parseInt(t.getAttribute("target"));return{source:"undefined"!=typeof n[e]?e:1,target:"undefined"!=typeof n[r]?r:1,weight:t.querySelector("data").textContent}}),s=n[0];s.x=a/2,s.y=i/2,s.fixed=!0,l.nodes(n).links(r).start();var u=d.selectAll(".link").data(r).enter().append("line").attr("class","link"),f=d.selectAll(".node").data(n).enter().append("g").attr("class","node").call(o);f.append("circle").attr("content",function(t){return t.text.toLowerCase()}).attr("id",function(t){return t.id}).attr("r",function(t){return c(2+4*t.weight)}),f.append("text").attr("dx",12).attr("dy",".35em").attr("text-anchor","middle").style("fill","red").text(function(t){return t.text}),l.on("tick",function(){u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}).attr("stroke-width",function(t){return t.weight}),f.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),$("#search").click(function(t){var e=$("#searchBox").val().toLowerCase();d3.selectAll(".node circle").transition().attr("fill","black"),""!==e&&d3.selectAll(".node circle[content*="+e+"]").transition().attr("fill","blue")})})}();